{% extends 'base.html' %}
{% load static %}
{% block content %}

    <section class="main_content dashboard_part large_header_bg">

       {% include 'includes/topbar.html' %}

        <div class="main_content_iner ">
            <div class="container-fluid p-0">
                <div class="row justify-content-center">
                    <div class="col-12">
                        <div class="dashboard_header mb_50">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="dashboard_header_title">
                                        <h3>Fill in the Blanks</h3>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="dashboard_breadcam text-end">
                                        <p><a href="{% url 'home' %}">Dashboard</a> <i class="fas fa-caret-right"></i> Task Attempt
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <div class="white_box mb_30">
                            <div class="row justify-content-center">
                                <div class="col-lg-10">

                                    <div class="modal-content cs_modal">
                                        <div class="modal-header justify-content-center theme_bg_1">
                                            <h5 class="modal-title text_white">{{task.task_name}}</h5>
                                        </div>
                                        <div class="modal-body">
                                            <p style="text-align: left;"> <h6> Instructions:</h6> Students fill in the blanks in a given text.</p>
                                           
                                            <!-- <h6>Question:</h6> -->
                                              <p id="question" style="text-align: left;">{{task.text_blank | safe}}</p>
                                              <br><br>
                                              <div class="row row-cols-4">
                                                <div class="col">
                                                    <div id="option1" class="card" draggable="true" ondragstart="drag(event)">
                                                        <div class="card-body">
                                                        {{ task.option1 }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div id="option2" class="card" draggable="true" ondragstart="drag(event)">
                                                        <div class="card-body">
                                                        {{ task.option2 }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div id="option3" class="card" draggable="true" ondragstart="drag(event)">
                                                        <div class="card-body">
                                                        {{ task.option3 }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div id="option4" class="card" draggable="true" ondragstart="drag(event)">
                                                        <div class="card-body">
                                                        {{ task.option4 }}
                                                        </div>
                                                    </div>
                                                </div>
                                                  
                                                  
                                                 
                                              </div>
                                              
                                            <form method="post" action="">
                                                {% csrf_token %}
                                                <!-- <label for="answer"><b>Answer</b></label> -->
                                                {% with ''|center:black_count as range_str %}
                                                    {% for i in range_str %}  
                                                    <div class="mt-2">
                                                    <input hidden id="answer{{ forloop.counter }}" type="text" name="answer{{ forloop.counter }}" class="form-control answer"
                                                        placeholder="Enter your Answer">
                                                </div>                
                                                    
                                                    {% endfor %}
                                                    {% endwith %}

                                                
                                               
                                                
                                                
                                              
                                                <button type="submit" href="#" class="btn_1 full_width text-center">Submit</button>
                                                
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            // Changes by hamze
            document.addEventListener('DOMContentLoaded', function () {
                console.log("HERE----")
                // Delay the replacement by 1000 milliseconds (1 second)
                setTimeout(function () {
                    // Get the container element
                    var blankContainer = document.getElementById('question');
                    console.log(blankContainer)
                    
                    // Initialize a counter variable
                    var dropZoneCounter = 0;

                    // Replace [blank] with the desired HTML
                    var replacedHTML = blankContainer.innerHTML.replace(/xxx/g, function(match, index) {
                        // Calculate the drop zone number based on the index of the match
                        dropZoneCounter++;
                        console.log('index',dropZoneCounter)
                        // Generate the drop zone HTML with the appropriate ID
                        return '<div id="drop' + dropZoneCounter + '" class="drop-zone" style="width: 300px; height: 70px; border: 1px solid #aaaaaa; border-radius: 1em;display:inline-block;" ondrop="drop(event)" ondragover="allowDrop(event)"></div>';
                    });

                    // Set the replaced HTML back to the container
                    blankContainer.innerHTML = replacedHTML;
                }, 1); // 1000 milliseconds = 1 second
            });
            // Changes by hamze end

            function allowDrop(ev) {
              ev.preventDefault();
            }
            
            function drag(ev) {
              ev.dataTransfer.setData("text", ev.target.id);
            //   console.log(ev)
              
            }
            
            
            function drop(ev) {
    ev.preventDefault();
    var data = ev.dataTransfer.getData("text");
    var draggedElement = document.getElementById(data);
    var dropTarget = ev.target;

    // Check if the drop target is the drop zone itself and is empty
    if (dropTarget.classList.contains("drop-zone") && dropTarget.childElementCount === 0) {
        var clonedElement = draggedElement.cloneNode(true);

        // Append the clone to the drop target
        dropTarget.appendChild(clonedElement);

        // Set draggable to true for the cloned element
        clonedElement.setAttribute("draggable", true);

        // Add the drag event listener to the cloned element
        clonedElement.addEventListener("dragstart", drag);

        // Add an event listener for the drag event on the cloned element
        clonedElement.addEventListener("drag", function (event) {
            // Remove the element from its parent when dragged
            var dropZoneId = dropTarget.id.charAt(dropTarget.id.length - 1);
        

            // Change the value of the corresponding answer field
            var hiddenInputid = "answer" + dropZoneId;
            if (event.target.parentNode) {
                event.target.parentNode.removeChild(event.target);
                var hiddenInput = document.getElementById(hiddenInputid);
                hiddenInput.value = "";
            }
        });

        // Get the original element by ID
        var optionElement = document.getElementById(data);
        console.log(optionElement.id.charAt(optionElement.id.length - 1));

        // Store the association between drop zone and audio element (you can use a hidden input field)
        var dropZoneId = dropTarget.id.charAt(dropTarget.id.length - 1);
        

        // Change the value of the corresponding answer field
        var hiddenInputid = "answer" + dropZoneId;
        
        var hiddenInput = document.getElementById(hiddenInputid);
        if (hiddenInput) {
            hiddenInput.value = optionElement.innerText;
        }

        // Add the class to the cloned element
        clonedElement.classList.add("draggable-element");
    }
}






   


            
        </script>
        {% endblock %}